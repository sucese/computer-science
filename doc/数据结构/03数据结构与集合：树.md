# æ•°æ®ç»“æ„ä¸é›†åˆï¼šæ ‘

**å…³äºä½œè€…**

>éƒ­å­æ˜Ÿï¼Œç¨‹åºå‘˜ï¼Œå‰ä»–æ‰‹ï¼Œä¸»è¦ä»äº‹Androidå¹³å°åŸºç¡€æ¶æ„æ–¹é¢çš„å·¥ä½œï¼Œæ¬¢è¿äº¤æµæŠ€æœ¯æ–¹é¢çš„é—®é¢˜ï¼Œå¯ä»¥å»æˆ‘çš„[Github](https://github.com/guoxiaoxing)æissueæˆ–è€…å‘é‚®ä»¶è‡³guoxiaoxingse@163.comä¸æˆ‘äº¤æµã€‚

**æ–‡ç« ç›®å½•**`       

- ä¸€ TreeMapå®ç°åŸç†
- äºŒ TreeSetå®ç°åŸç†
    
æ›´å¤šæ–‡ç« è¯·å‚è§ï¼š[Data Structure And Algorithm](https://github.com/guoxiaoxing/data-structure-and-algorithm/blob/master/README.md)

åœ¨åˆ†æä¸æ ‘ç›¸å…³çš„é›†åˆçš„æ¦‚å¿µä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹æ ‘çš„ç›¸å…³åŸç†ã€‚

>æ ‘æ˜¯ä¸€ç§æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆADTï¼‰æˆ–æ˜¯å®ä½œè¿™ç§æŠ½è±¡æ•°æ®ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥æ¨¡æ‹Ÿå…·æœ‰æ ‘çŠ¶ç»“æ„æ€§è´¨çš„æ•°æ®é›†åˆã€‚å®ƒæ˜¯ç”±nï¼ˆn>0ï¼‰ä¸ªæœ‰é™èŠ‚ç‚¹ç»„æˆä¸€ä¸ªå…·æœ‰å±‚æ¬¡å…³ç³»çš„é›†åˆã€‚æŠŠ
å®ƒå«åšâ€œæ ‘â€æ˜¯å› ä¸ºå®ƒçœ‹èµ·æ¥åƒä¸€æ£µå€’æŒ‚çš„æ ‘ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯æ ¹æœä¸Šï¼Œè€Œå¶æœä¸‹çš„ã€‚

æ ‘æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- æ¯ä¸ªèŠ‚ç‚¹æœ‰é›¶ä¸ªæˆ–å¤šä¸ªå­èŠ‚ç‚¹ï¼›
- æ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹ç§°ä¸ºæ ¹èŠ‚ç‚¹ï¼›
- æ¯ä¸€ä¸ªéæ ¹èŠ‚ç‚¹æœ‰ä¸”åªæœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼›
- é™¤äº†æ ¹èŠ‚ç‚¹å¤–ï¼Œæ¯ä¸ªå­èŠ‚ç‚¹å¯ä»¥åˆ†ä¸ºå¤šä¸ªä¸ç›¸äº¤çš„å­æ ‘ï¼›

ä¸æ ‘ç›¸å…³çš„æ¦‚å¿µ

- èŠ‚ç‚¹çš„åº¦ï¼šä¸€ä¸ªèŠ‚ç‚¹å«æœ‰çš„å­æ ‘çš„ä¸ªæ•°ç§°ä¸ºè¯¥èŠ‚ç‚¹çš„åº¦ï¼›
- æ ‘çš„åº¦ï¼šä¸€æ£µæ ‘ä¸­ï¼Œæœ€å¤§çš„èŠ‚ç‚¹çš„åº¦ç§°ä¸ºæ ‘çš„åº¦ï¼›
- å¶èŠ‚ç‚¹æˆ–ç»ˆç«¯èŠ‚ç‚¹ï¼šåº¦ä¸ºé›¶çš„èŠ‚ç‚¹ï¼›
- éç»ˆç«¯èŠ‚ç‚¹æˆ–åˆ†æ”¯èŠ‚ç‚¹ï¼šåº¦ä¸ä¸ºé›¶çš„èŠ‚ç‚¹ï¼›
- çˆ¶äº²èŠ‚ç‚¹æˆ–çˆ¶èŠ‚ç‚¹ï¼šè‹¥ä¸€ä¸ªèŠ‚ç‚¹å«æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™è¿™ä¸ªèŠ‚ç‚¹ç§°ä¸ºå…¶å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼›
- å­©å­èŠ‚ç‚¹æˆ–å­èŠ‚ç‚¹ï¼šä¸€ä¸ªèŠ‚ç‚¹å«æœ‰çš„å­æ ‘çš„æ ¹èŠ‚ç‚¹ç§°ä¸ºè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼›
- å…„å¼ŸèŠ‚ç‚¹ï¼šå…·æœ‰ç›¸åŒçˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹äº’ç§°ä¸ºå…„å¼ŸèŠ‚ç‚¹ï¼›
- èŠ‚ç‚¹çš„å±‚æ¬¡ï¼šä»æ ¹å¼€å§‹å®šä¹‰èµ·ï¼Œæ ¹ä¸ºç¬¬1å±‚ï¼Œæ ¹çš„å­èŠ‚ç‚¹ä¸ºç¬¬2å±‚ï¼Œä»¥æ­¤ç±»æ¨ï¼›
- æ·±åº¦ï¼šå¯¹äºä»»æ„èŠ‚ç‚¹n, nçš„æ·±åº¦ä¸ºä»æ ¹åˆ°nçš„å”¯ä¸€è·¯å¾„é•¿ï¼Œæ ¹çš„æ·±åº¦ä¸º0ï¼›
- é«˜åº¦ï¼šå¯¹äºä»»æ„èŠ‚ç‚¹n, nçš„é«˜åº¦ä¸ºä»nåˆ°ä¸€ç‰‡æ ‘å¶çš„æœ€é•¿è·¯å¾„é•¿ï¼Œæ‰€æœ‰æ ‘å¶çš„é«˜åº¦ä¸º0ï¼›
- å ‚å…„å¼ŸèŠ‚ç‚¹ï¼šçˆ¶èŠ‚ç‚¹åœ¨åŒä¸€å±‚çš„èŠ‚ç‚¹äº’ä¸ºå ‚å…„å¼Ÿï¼›
- èŠ‚ç‚¹çš„ç¥–å…ˆï¼šä»æ ¹åˆ°è¯¥èŠ‚ç‚¹æ‰€ç»åˆ†æ”¯ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹ï¼›
- å­å­™ï¼šä»¥æŸèŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘ä¸­ä»»ä¸€èŠ‚ç‚¹éƒ½ç§°ä¸ºè¯¥èŠ‚ç‚¹çš„å­å­™ã€‚
- æ£®æ—ï¼šç”±mï¼ˆm>=0ï¼‰æ£µäº’ä¸ç›¸äº¤çš„æ ‘çš„é›†åˆç§°ä¸ºæ£®æ—ï¼›

æ³¨ï¼šå‚ç…§äº²æˆšå…³ç³»ï¼Œè¿™äº›æ¦‚å¿µå¾ˆå¥½ç†è§£ï¼Œå®¶æ—è°±ä¹Ÿæ˜¯ä¸€ç§æ ‘ç»“æ„ã€‚ğŸ˜€

æ ‘çš„åˆ†ç±»

- æ— åºæ ‘ï¼šæ ‘ä¸­ä»»æ„èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰é¡ºåºå…³ç³»ï¼Œè¿™ç§æ ‘ç§°ä¸ºæ— åºæ ‘ï¼Œä¹Ÿç§°ä¸ºè‡ªç”±æ ‘ï¼›
- æœ‰åºæ ‘ï¼šæ ‘ä¸­ä»»æ„èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¹‹é—´æœ‰é¡ºåºå…³ç³»ï¼Œè¿™ç§æ ‘ç§°ä¸ºæœ‰åºæ ‘ï¼›

å…¶ä¸­æœ‰åºæ ‘åˆåˆ†ä¸ºï¼š

- äºŒå‰æ ‘ï¼šæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå«æœ‰ä¸¤ä¸ªå­æ ‘çš„æ ‘ç§°ä¸ºäºŒå‰æ ‘ï¼›
- å®Œå…¨äºŒå‰æ ‘ï¼šå¯¹äºä¸€é¢—äºŒå‰æ ‘ï¼Œå‡è®¾å…¶æ·±åº¦ä¸ºdï¼ˆd>1ï¼‰ã€‚é™¤äº†ç¬¬då±‚å¤–ï¼Œå…¶å®ƒå„å±‚çš„èŠ‚ç‚¹æ•°ç›®å‡å·²è¾¾æœ€å¤§å€¼ï¼Œä¸”ç¬¬då±‚æ‰€æœ‰èŠ‚ç‚¹ä»å·¦å‘å³è¿ç»­åœ°ç´§å¯†æ’åˆ—ï¼Œè¿™æ ·çš„äºŒå‰æ ‘è¢«ç§°ä¸ºå®Œå…¨äºŒå‰æ ‘ï¼›
- æ»¡äºŒå‰æ ‘ï¼šæ‰€æœ‰å¶èŠ‚ç‚¹éƒ½åœ¨æœ€åº•å±‚çš„å®Œå…¨äºŒå‰æ ‘ï¼›
- AVLæ ‘ï¼šå½“ä¸”ä»…å½“ä»»ä½•èŠ‚ç‚¹çš„ä¸¤æ£µå­æ ‘çš„é«˜åº¦å·®ä¸å¤§äº1çš„äºŒå‰æ ‘ï¼›
- äºŒå‰æŸ¥æ‰¾æ ‘ï¼šæ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå®ƒçš„å·¦å­æ ‘ä¸­æ‰€æœ‰é¡¹å°äºXä¸­çš„é¡¹ï¼Œå®ƒçš„å³å­æ ‘ä¸­çš„æ‰€æœ‰é¡¹å¤§äºXä¸­çš„é¡¹ã€‚
- éœå¤«æ›¼æ ‘ï¼šå¸¦æƒè·¯å¾„æœ€çŸ­çš„äºŒå‰æ ‘ç§°ä¸ºå“ˆå¤«æ›¼æ ‘æˆ–æœ€ä¼˜äºŒå‰æ ‘ï¼›
- Bæ ‘ï¼šä¸€ç§å¯¹è¯»å†™æ“ä½œè¿›è¡Œä¼˜åŒ–çš„è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œèƒ½å¤Ÿä¿æŒæ•°æ®æœ‰åºï¼Œæ‹¥æœ‰å¤šä½™ä¸¤ä¸ªå­æ ‘ã€‚

**äºŒå‰æŸ¥æ‰¾æ ‘**

>äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ä¸€ç§æœ‰åºäºŒå‰æ ‘ï¼Œå®ƒçš„æŸ¥æ‰¾ã€æ’å…¥çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logN)

äºŒå‰æŸ¥æ‰¾æ˜¯æ˜¯ä¸€ç§æœ‰åºäºŒå‰æ ‘.

**ä¸»è¦ç‰¹ç‚¹**

- è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ã€‚
- è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ã€‚
- ä»»æ„èŠ‚ç‚¹çš„å·¦å³å­æ ‘å¶ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘
- æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚

å°±å°±æ˜¯è¯´äºŒå‰æŸ¥æ‰¾æ ‘ä¸Šçš„èŠ‚ç‚¹æ˜¯æ’å¥½åºçš„ï¼šå·¦å­æ ‘ < æ ¹èŠ‚ç‚¹ < å³å­æ ‘ã€‚

**æ€§èƒ½åˆ†æ**

- åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œå³å½“å…ˆåæ’å…¥çš„å…³é”®å­—æœ‰åºæ—¶ï¼Œæ„é€ æˆçš„äºŒå‰æŸ¥æ‰¾æ ‘èœ•å˜ä¸ºå•æ”¯æ ‘ï¼Œè¾“çš„æ·±åº¦ä¸ºnï¼Œå…¶å¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸º(n+1)/2ã€‚
- åœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘çš„å½¢æ€å’ŒæŠ˜åŠæŸ¥æ‰¾çš„åˆ¤å®šæ ‘ç›¸åŒï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸ºO(log2(N))ã€‚

æˆ‘ä»¬æ¥çœ‹çœ‹äºŒå‰æŸ¥æ‰¾æ ‘ä¸Šçš„ç›¸å…³æ“ä½œã€‚

<img src="https://github.com/guoxiaoxing/data-structure-and-algorithm/raw/master/art/tree/binary_search_tree.png"/>

#### æ„é€ 

å½“æˆ‘ä»¬ç”¨ä¸€ç»„æ•°å€¼æ„é€ ä¸€æ£µäºŒå‰æŸ¥æ‰¾æ ‘æ—¶ï¼Œå°±ç›¸å½“äºå¯¹è¿™ç»„æ•°å€¼è¿›è¡Œäº†æ’åºï¼Œåœ¨æœ€åæƒ…å†µä¸‹ï¼Œå³è¯¥ç»„æ•°å€¼æ˜¯ä»å°åˆ°è¾¾æ’å¥½åºçš„ï¼Œæ„é€ å‡ºæ¥çš„äºŒå‰æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½
æ²¡æœ‰å·¦å­æ ‘ï¼Œè¿™ç§æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(N2)ã€‚ï¼ˆNçš„å¹³æ–¹ï¼‰

å¦å¤–ï¼Œæ ‘æ’åºçš„é—®é¢˜ä½¿å¾—CPU Cacheæ€§èƒ½è¾ƒå·®ï¼Œç‰¹åˆ«æ˜¯å½“èŠ‚ç‚¹æ˜¯åŠ¨æ€å†…å­˜åˆ†é…æ—¶ã€‚è€Œå †æ’åºçš„CPU Cacheæ€§èƒ½è¾ƒå¥½ã€‚å¦ä¸€æ–¹é¢ï¼Œæ ‘æ’åºæ˜¯æœ€ä¼˜çš„å¢é‡æ’åºï¼ˆincremental sortingï¼‰ç®—æ³•ï¼Œ
ä¿æŒä¸€ä¸ªæ•°å€¼åºåˆ—çš„æœ‰åºæ€§ã€‚

#### æŸ¥æ‰¾

ç”±äºäºŒå‰æŸ¥æ‰¾æ ‘å…·æœ‰å·¦å­æ ‘ < æ ¹èŠ‚ç‚¹ < å³å­æ ‘çš„ç‰¹ç‚¹ï¼Œå› æ­¤åœ¨äºŒå‰æŸ¥æ‰¾æ ‘bä¸­æŸ¥æ‰¾xçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š

1. è‹¥bæ˜¯ç©ºæ ‘ï¼Œåˆ™æŸ¥æ‰¾å¤±è´¥ï¼Œå¦åˆ™ï¼š
2. è‹¥xç­‰äºæ ¹èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™æŸ¥æ‰¾æˆåŠŸï¼Œå¦åˆ™ï¼š
3. è‹¥xå°äºbæ ¹èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™æŸ¥æ‰¾å·¦å­æ ‘ï¼Œå¦åˆ™
4. è‹¥xå¤§äºbæ ¹èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™æŸ¥æ‰¾å³å­æ ‘ã€‚

æ•´ä¸ªæµç¨‹æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚

#### æ’å…¥

æ’å…¥çš„è¿‡ç¨‹ä¹Ÿæ˜¯æŸ¥æ‰¾çš„è¿‡ç¨‹ï¼Œåœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æ’å…¥èŠ‚ç‚¹xçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š

1. è‹¥bæ˜¯ç©ºæ ‘ï¼Œåˆ™xä½œä¸ºæ ¹èŠ‚ç‚¹æ’å…¥ï¼Œå¦åˆ™ï¼š
2. è‹¥xçš„å€¼ç­‰äºæ ¹èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™ï¼š
3. è‹¥xçš„å€¼å°äºæ ¹èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™å°†xæ’å…¥å½“è¯¥æ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸­ï¼Œå¦åˆ™
4. å°†xæ’å…¥è¯¥æ ¹èŠ‚ç‚¹çš„å³å­æ ‘ä¸­ã€‚

è¿™ä¹Ÿæ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œè¿™é‡Œæˆ‘ä»¬è¦å…³æ³¨ä¸¤ç‚¹ï¼š

- æ’å…¥çš„è¿‡ç¨‹ä¹Ÿæ˜¯æŸ¥æ‰¾çš„è¿‡ç¨‹ 
- äºŒå‰æŸ¥æ‰¾æ ‘ä¸å…è®¸æœ‰ç›¸åŒå€¼çš„èŠ‚ç‚¹

##### åˆ é™¤

åœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸Šåˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š

1. è‹¥åˆ é™¤çš„æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™ä¸ä¼šç ´åæ ‘çš„ç»“æ„ï¼Œåªéœ€è¦ä¿®æ”¹å…¶åŒäº²èŠ‚ç‚¹çš„æŒ‡é’ˆå³å¯ã€‚
2. è‹¥åˆ é™¤çš„èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­©å­èŠ‚ç‚¹ï¼Œåˆ™ç”¨å®ƒçš„å­©å­èŠ‚ç‚¹ä»£æ›¿å®ƒçš„ä½ç½®å³å¯ï¼Œå¦‚æ­¤ä¹Ÿä¸ä¼šç ´åçº¢é»‘æ ‘çš„ç»“æ„ã€‚
3. è‹¥åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­©å­èŠ‚ç‚¹ï¼Œè¿™ç§æƒ…å†µå¤æ‚ä¸€ä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ‰¾åˆ°è¦åˆ é™¤èŠ‚ç‚¹Xçš„å·¦å­æ ‘é‡Œçš„æœ€å¤§å…ƒç´ æˆ–è€…å³å­æ ‘é‡Œçš„æœ€å°å…ƒç´ ï¼Œç„¶åç”¨Mæ›¿æ¢æ‰Xï¼Œå†åˆ é™¤èŠ‚ç‚¹ï¼Œå› ä¸ºæ­¤æ—¶Mæœ€å¤šåªä¼šæœ‰ä¸€ä¸ª
èŠ‚ç‚¹ï¼ˆå¦‚æœå·¦å­æ ‘æœ€å¤§å…ƒç´ åˆ™æ²¡æœ‰å³å­èŠ‚ç‚¹ï¼Œè‹¥æ˜¯å³å­æ ‘æœ€å°å…ƒç´ åˆ™æ²¡æœ‰å·¦å­èŠ‚ç‚¹ï¼‰ï¼Œè‹¥Mæ²¡æœ‰å­©å­èŠ‚ç‚¹ï¼Œç›´æ¥è¿›å…¥æƒ…å†µ1å¤„ç†ï¼Œè‹¥Måªæœ‰ä¸€ä¸ªå­©å­ï¼Œåˆ™ç›´æ¥è¿›å…¥æƒ…å†µ2å¤„ç†ã€‚

å¦å¤–ï¼Œå¦‚æœåˆ é™¤çš„æ¬¡æ•°ä¸å¤šï¼Œå¯ä»¥é‡‡ç”¨**æ‡’æƒ°åˆ é™¤**çš„æ–¹å¼ï¼Œå³å½“ä¸€ä¸ªå…ƒç´ åˆ é™¤æ—¶ï¼Œå®ƒä»ç„¶ç•™åœ¨æ ‘ä¸­ï¼Œåªæ˜¯è¢«æ¯”è¾ƒä¸ºå·²åˆ é™¤ï¼Œè¿™ç§æ–¹å¼åœ¨æœ‰é‡å¤é¡¹æ˜¯ç‰¹åˆ«æœ‰ç”¨ï¼Œ
å¦å¤–å¦‚æœåˆ é™¤çš„å…ƒç´ åˆé‡æ–°æ’å…¥ï¼Œè¿™ç§æ–¹å¼å¯ä»¥é¿å…æ–°å•å…ƒçš„åˆ›å»ºå¼€é”€ã€‚

**AVLæ ‘**

>AVLæ ‘æ˜¯å¸¦æœ‰å¹³è¡¡æ¡ä»¶çš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚

**ä¸»è¦ç‰¹ç‚¹**

- AVLæ ‘ä¸­çš„ä»»ä½•é˜¶æ®µçš„ä¸¤æ£µå­æ ‘é«˜åº¦æœ€å¤§å·®åˆ«ä¸º1.

AVLæ ‘è¿˜æœ‰ä¸ªå¹³è¡¡å› å­çš„æ¦‚å¿µï¼Œå¹³è¡¡å› å­ = å·¦å­æ ‘é«˜åº¦ - å³å­æ ‘é«˜åº¦ï¼Œå› æ­¤å¹³è¡¡å› å­ä¸º-1ï¼Œ0ï¼Œ1çš„ä¸ºå¹³è¡¡äºŒå‰æ ‘ï¼Œå…¶ä»–çš„éƒ½æ˜¯ä¸å¹³è¡¡çš„ã€‚

å¦å¤–ï¼ŒæŠŠä¸€æ£µä¸å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘å˜æˆä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º**AVLæ—‹è½¬**ã€‚

æˆ‘ä»¬æ¥çœ‹çœ‹ä¸åŒæƒ…å†µä¸‹AVLæ—‹è½¬å¦‚ä½•è¿›è¡Œã€‚

- å·¦å·¦æƒ…å†µï¼šå³æ—‹
- å³å³æƒ…å†µï¼šå·¦æ—‹
- å·¦å³æƒ…å†µï¼šå…ˆå·¦æ—‹ï¼Œå†å³æ—‹
- å³å·¦æƒ…å†µï¼šå…ˆå³æ—‹ï¼Œå†å·¦æ—‹

æ³¨ï¼šæ‰€è°“å·¦å·¦æŒ‡çš„æ˜¯å·¦è¾¹çš„å·¦å­æ ‘å¤šäº†ä¸€ä¸ªï¼Œå…¶ä»–çš„ä¾æ­¤ç±»æ¨ã€‚

å…·ä½“æ“ä½œå¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·¦å·¦æƒ…å†µå’Œå³å³æƒ…å†µåªéœ€è¦å•æ—‹è½¬å°±å¯ä»¥å®Œæˆï¼Œå·¦å³æƒ…å†µä¸å³å·¦æƒ…å†µéœ€è¦å…ˆæŠŠå®ƒä»¬å˜æˆå·¦å·¦æƒ…å†µä¸å³å³æƒ…å†µ
å†è¿›è¡Œæ—‹è½¬ï¼Œå› æ­¤è¿™ä¸¤ç§æƒ…å†µéœ€è¦åŒæ—‹è½¬æ‰èƒ½å®Œæˆã€‚

<img src="https://github.com/guoxiaoxing/data-structure-and-algorithm/raw/master/art/tree/avl_tree.png"/>

**æ€§èƒ½åˆ†æ**

æŸ¥æ‰¾ã€æ’å…¥ä¸åˆ é™¤åœ¨å¹³å‡å’Œæœ€åçš„æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logN)ã€‚

AVLæ ‘ä¹Ÿæ˜¯äºŒå‰æŸ¥æ‰¾æ ‘çš„ä¸€ç§ï¼Œå®ƒçš„å¾ˆå¤šæ“ä½œéƒ½å¯ä»¥å‘æˆ‘ä»¬ä¸Šé¢æè¿°çš„äºŒå‰æŸ¥æ‰¾æ ‘çš„æ“ä½œé‚£æ ·è¿›è¡Œã€‚åˆ é™¤æ“ä½œæœ‰ç‚¹ä¾‹å¤–ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œåˆ é™¤æ“ä½œ
æ—¶å¯ä»¥æŠŠè¦åˆ é™¤çš„èŠ‚ç‚¹å‘ä¸‹æ—‹è½¬å½¢æˆä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œç„¶åç›´æ¥åˆ é™¤è¿™ä¸ªå¶å­èŠ‚ç‚¹ï¼Œå› ä¸ºæ—‹è½¬æˆå¶å­èŠ‚ç‚¹æœŸé—´ï¼Œåšå¤šæœ‰logNä¸ªèŠ‚ç‚¹è¢«æ—‹è½¬ï¼Œæ¯æ¬¡
AVLæ—‹è½¬èŠ±è´¹çš„äº‹ä»¶å›ºå®šï¼Œæ‰€ä»¥åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logN)ã€‚

**çº¢é»‘æ ‘**

>çº¢é»‘æ ‘æ˜¯å¹³è¡¡äºŒå‰æ ‘çš„å˜ç§ï¼Œå®ƒçš„æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logN).

çº¢é»‘æ ‘æ˜¯ä¸€ç§å…·æœ‰ç€è‰²æ€§è´¨çš„æ ‘ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- æ¯ä¸ªèŠ‚ç‚¹è¢«ç€æˆçº¢è‰²æˆ–è€…é»‘è‰²
- æ ¹æ˜¯é»‘è‰²çš„
- å¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ï¼Œå¶å­èŠ‚ç‚¹æŒ‡çš„æ˜¯NULLèŠ‚ç‚¹ï¼Œæœ‰äº›çº¢é»‘æ ‘å›¾ä¸­å¯èƒ½æ²¡æœ‰æ ‡è®°å‡ºæ¥ã€‚
- å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œé‚£ä¹ˆä»–é¢å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šå­˜åœ¨ä¸¤ä¸ªçº¢è‰²èŠ‚ç‚¹æ¯—é‚»ã€‚
- ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆNULLèŠ‚ç‚¹ï¼‰çš„æ¯ä¸€æ¡è·¯å¾„å¿…é¡»åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚

çº¢é»‘æ ‘ä¹Ÿæ˜¯ä¸€ç§äºŒå‰æŸ¥æ‰¾æ ‘ï¼ŒæŸ¥æ‰¾æ“ä½œä¸äºŒå‰æŸ¥æ‰¾æ ‘ç›¸åŒï¼Œæ’å…¥ä¸åˆ é™¤æ“ä½œæœ‰æ‰€ä¸åŒã€‚

**Bæ ‘**

>Bæ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„æ ‘ï¼Œèƒ½å¤Ÿä¿æŒæ•°æ®æœ‰åºï¼ŒBæ ‘ä¸ºç³»ç»Ÿå¤§å—æ•°æ®çš„è¯»å†™æ“ä½œåšäº†ä¼˜åŒ–ï¼Œé€šå¸¸ç”¨åœ¨æ•°æ®åº“ä¸æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ä¸Šã€‚

æˆ‘ä»¬å‰é¢è®²è§£äº†äºŒå‰æŸ¥æ‰¾æ ‘ã€AVLæ ‘ï¼Œçº¢é»‘æ ‘ï¼Œè¿™ä¸‰ç§éƒ½æ˜¯å…¸å‹çš„äºŒå‰æŸ¥æ‰¾æ ‘ç»“æ„ï¼Œå…¶æŸ¥æ‰¾çš„äº‹ä»¶å¤æ‚åº¦O(logN)ä¸æ ‘çš„æ·±åº¦æœ‰å…³ï¼Œè€ƒè™‘è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œå¦‚æœæœ‰
å¤§é‡çš„æ•°æ®ï¼Œè€ŒèŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®æœ‰é™ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½å»æ‰©å……æ ‘çš„æ·±åº¦ï¼Œå°±ä¼šå¯¼è‡´æŸ¥æ‰¾æ•ˆç‡ä½ä¸‹ã€‚

æ€ä¹ˆè§£å†³è¿™ç§é—®é¢˜ï¼Œä¸€ä¸ªç®€å•çš„æƒ³æ³•å°±æ˜¯ï¼šäºŒå‰å˜å¤šå‰ã€‚

è¿™é‡Œæˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹å¸¸è§çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§æ ‘ç»“æ„ï¼Œåœ¨æŸ¥æ‰¾æ–‡ä»¶æ—¶ï¼Œæ ‘çš„æ·±åº¦å°±å†³å®šäº†æŸ¥æ‰¾çš„æ•ˆç‡ã€‚å› æ­¤Bæ ‘å°±æ˜¯ä¸ºäº†å‡å°‘æ•°çš„æ·±åº¦ä»è€Œæé«˜æŸ¥æ‰¾æ•ˆç‡çš„ä¸€ç§
æ•°æ®ç»“æ„ã€‚

**ä¸»è¦ç‰¹ç‚¹**

ä¸€ä¸ªé˜¶ä¸ºMçš„Bæ ‘å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

æ³¨ï¼šMé˜¶æŒ‡çš„æ˜¯Må‰æŸ¥æ‰¾æ ‘ï¼Œä¾‹å¦‚M = 2ï¼Œåˆ™ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ã€‚

- æ•°æ®é¡¹å­˜å‚¨åœ¨æ ‘å¶ä¸Š
- éå¶èŠ‚ç‚¹å­˜å‚¨ç›´åˆ°M-1ä¸ªå…³é”®å­—ä»¥æŒ‡ç¤ºæœç´¢æ–¹å‘ï¼šå…³é”®å­—ä»£è¡¨å­æ ‘i+1ä¸­æœ€å°çš„å…³é”®å­—
- æ ‘çš„æ ¹æˆ–è€…æ˜¯ä¸€ç‰‡æ ‘å¶ï¼Œæˆ–è€…å…¶å„¿å­æ•°éƒ½åœ¨2å’ŒMä¹‹é—´ã€‚
- é™¤æ ¹å¤–ï¼Œæ‰€æœ‰éæ ‘å¶èŠ‚ç‚¹çš„å„¿å­æ ‘åœ¨M/2ä¸Mä¹‹é—´ã€‚
- æ‰€æœ‰çš„æ ‘å¶éƒ½åœ¨ç›¸åŒçš„æ·±åº¦ä¸Šæ‹¥æœ‰çš„æ•°æ®é¡¹éƒ½åœ¨L/2ä¸Lä¹‹é—´ã€‚

**æ€§èƒ½åˆ†æ**

Bæ ‘åœ¨æŸ¥æ‰¾ã€æ’å…¥ä»¥åŠåˆ é™¤ç­‰æ“ä½œä¸­ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(logN)ã€‚

åœ¨æ–‡ç« [02æ•°æ®ç»“æ„ä¸é›†åˆï¼šæ•°ç»„ã€é“¾è¡¨ã€æ ˆä¸é˜Ÿåˆ—](https://github.com/guoxiaoxing/data-structure-and-algorithm/blob/master/doc/æ•°æ®ç»“æ„/02æ•°æ®ç»“æ„ä¸é›†åˆï¼šæ•°ç»„ã€é“¾è¡¨ã€æ ˆä¸é˜Ÿåˆ—.md)ä¸­æˆ‘ä»¬
è®¨è®ºäº†ArrayListä¸LinkedListçš„å®ç°ï¼Œå®ƒä»¬çš„ç“¶é¢ˆåœ¨äºæŸ¥æ‰¾æ•ˆç‡ä½ä¸‹ã€‚å› è€ŒJavaé›†åˆè®¾è®¡äº†Setä¸Mapæ¥å£ï¼Œå®ƒä»¬åœ¨æ’å…¥ã€åˆ é™¤ä¸æŸ¥æ‰¾ç­‰åŸºæœ¬æ“ä½œéƒ½æœ‰è‰¯å¥½çš„è¡¨ç°ã€‚

## ä¸€ TreeMapå®ç°åŸç†

>TreeMapåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œå®ƒçš„æŸ¥æ‰¾å’Œæ’åºä½¿ç”¨çš„æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾æ–¹å¼ï¼Œå®ƒæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæœ‰åºçš„ã€‚

TreeMapçš„ç±»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

<img src="https://github.com/guoxiaoxing/data-structure-and-algorithm/raw/master/art/tree/TreeMap_class.png"/>

å› æ­¤åªè¦ç†è§£äº†TreeMapå®ç°å³å¯ï¼ŒTreeSetåœ¨åŠŸèƒ½ä¸Šå®Œå…¨ä¾èµ–äºTreeMapã€‚

TreeMapå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- TreeMapæ˜¯ä¸€ä¸ªæœ‰åºçš„key-valueé›†åˆï¼ŒåŸºäºçº¢é»‘æ ‘å®ç°ã€‚
- æ²¡æœ‰å®ç°åŒæ­¥

TreeMapå®ç°ä»¥ä¸‹æ¥å£ï¼š

- NavigableMapï¼šæ”¯æŒä¸€ç³»åˆ—å¯¼èˆªæ–¹æ³•ï¼Œæ¯”å¦‚è¿”å›æœ‰åºçš„keyé›†åˆã€‚
- Cloneableï¼šå¯ä»¥è¢«å…‹éš†ã€‚
- Serializableï¼šæ”¯æŒåºåˆ—åŒ–ã€‚

### 1.1 æˆå‘˜å˜é‡

```java
//æ¯”è¾ƒå™¨
private final Comparator<? super K> comparator;
//æ ¹èŠ‚ç‚¹
private transient TreeMapEntry<K,V> root = null;
//é›†åˆå¤§å°
private transient int size = 0;
//ä¿®æ”¹æ¬¡æ•°
private transient int modCount = 0;
```

### 1.2 æ„é€ æ–¹æ³•

```java
public TreeMap() {
    //é»˜è®¤æ¯”è¾ƒå™¨
    comparator = null;
}

public TreeMap(Comparator<? super K> comparator) {
    //æŒ‡å®šæ¯”è¾ƒå™¨
    this.comparator = comparator;
}


public TreeMap(Map<? extends K, ? extends V> m) {
    //é»˜è®¤æ¯”è¾ƒå™¨
    comparator = null;
    putAll(m);
}

public TreeMap(SortedMap<K, ? extends V> m) {
    //æŒ‡å®šæ¯”è¾ƒå™¨
    comparator = m.comparator();
    try {
        buildFromSorted(m.size(), m.entrySet().iterator(), null, null);
    } catch (java.io.IOException cannotHappen) {
    } catch (ClassNotFoundException cannotHappen) {
    }
}
```

### 1.2 å†…éƒ¨ç±»

TreeMapé‡Œé¢å®šä¹‰äº†é™æ€å†…éƒ¨ç±»TreeMapEntryæ¥æè¿°èŠ‚ç‚¹ä¿¡æ¯ã€‚

```java
   static final class TreeMapEntry<K,V> implements Map.Entry<K,V> {
        //é”®
        K key;
        //å€¼
        V value;
        //æŒ‡å‘å·¦å­æ ‘çš„å¼•ç”¨
        TreeMapEntry<K,V> left = null;
        //æŒ‡å‘å³å­æ ‘çš„å¼•ç”¨
        TreeMapEntry<K,V> right = null;
        //æŒ‡å‘çˆ¶èŠ‚ç‚¹çš„å¼•ç”¨
        TreeMapEntry<K,V> parent;
        //èŠ‚ç‚¹é¢œè‰²ï¼Œé»˜è®¤ä¸ºé»‘è‰²
        boolean color = BLACK;

        /**
         * Make a new cell with given key, value, and parent, and with
         * {@code null} child links, and BLACK color.
         */
        TreeMapEntry(K key, V value, TreeMapEntry<K,V> parent) {
            this.key = key;
            this.value = value;
            this.parent = parent;
        }

        /**
         * Returns the key.
         *
         * @return the key
         */
        public K getKey() {
            return key;
        }

        /**
         * Returns the value associated with the key.
         *
         * @return the value associated with the key
         */
        public V getValue() {
            return value;
        }

        /**
         * Replaces the value currently associated with the key with the given
         * value.
         *
         * @return the value associated with the key before this method was
         *         called
         */
        public V setValue(V value) {
            V oldValue = this.value;
            this.value = value;
            return oldValue;
        }

        public boolean equals(Object o) {
            if (!(o instanceof Map.Entry))
                return false;
            Map.Entry<?,?> e = (Map.Entry<?,?>)o;

            return valEquals(key,e.getKey()) && valEquals(value,e.getValue());
        }

        public int hashCode() {
            int keyHash = (key==null ? 0 : key.hashCode());
            int valueHash = (value==null ? 0 : value.hashCode());
            return keyHash ^ valueHash;
        }

        public String toString() {
            return key + "=" + value;
        }
    }
```

ä»TreeMapEntryå¯ä»¥çœ‹å‡ºï¼ŒTreeMapå†…éƒ¨çš„å­˜å‚¨ç»“æ„æ˜¯ä¸€æ£µçº¢é»‘æ ‘ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

<img src="https://github.com/guoxiaoxing/data-structure-and-algorithm/raw/master/art/tree/TreeMap_structure.png"/>

å­˜å‚¨æ•°æ®çš„æ—¶å€™ä¹Ÿåœ¨çº¢é»‘æ ‘ä¸ŠæŒ‰ç…§comparatorå®šä¹‰çš„æ¯”è¾ƒæ–¹å¼è¿›è¡Œæ’åºï¼Œå› ä¸ºçº¢é»‘æ ‘ä¹Ÿæ˜¯ä¸€ä¸ªäºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ‰€ä»¥æŸ¥æ‰¾æ’åºçš„è¿‡ç¨‹ä¹Ÿæ˜¯ä¸€ä¸ªäºŒå‰æŸ¥æ‰¾æ ‘çš„
çš„æŸ¥æ‰¾æ–¹å¼ï¼Œ

### 1.3 æ“ä½œæ–¹æ³• 

åœ¨æ­£å¼ä»‹ç»TreeMapé‡Œçš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹TreeMapé‡Œå…³äºèŠ‚ç‚¹æŸ“è‰²ï¼Œæ ‘çš„æ—‹è½¬ç­‰æ“ä½œçš„å®ç°ï¼Œå®ƒä»¬æ˜¯TreeMapå®ç°çš„åŸºç¡€ã€‚

**èŠ‚ç‚¹æŸ“è‰²**

<img src="https://github.com/guoxiaoxing/data-structure-and-algorithm/raw/master/art/tree/node_color.png"/>

åœ¨ä»‹ç»æŸ“è‰²è§„åˆ™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹çº¢é»‘æ ‘çš„ç‰¹ç‚¹ï¼š

- æ¯ä¸ªèŠ‚ç‚¹è¢«ç€æˆçº¢è‰²æˆ–è€…é»‘è‰²
- æ ¹æ˜¯é»‘è‰²çš„
- å¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ï¼Œå¶å­èŠ‚ç‚¹æŒ‡çš„æ˜¯NULLèŠ‚ç‚¹ï¼Œæœ‰äº›çº¢é»‘æ ‘å›¾ä¸­å¯èƒ½æ²¡æœ‰æ ‡è®°å‡ºæ¥ã€‚
- å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œé‚£ä¹ˆä»–é¢å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šå­˜åœ¨ä¸¤ä¸ªçº¢è‰²èŠ‚ç‚¹æ¯—é‚»ã€‚
- ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆNULLèŠ‚ç‚¹ï¼‰çš„æ¯ä¸€æ¡è·¯å¾„å¿…é¡»åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚

å…³äºèŠ‚ç‚¹æŸ“è‰²ï¼Œæˆ‘ä»¬æœ‰å¤šç§æƒ…å†µéœ€è¦è€ƒè™‘ã€‚

é¦–å…ˆè¯´æ˜

- è‹¥æ–°èŠ‚ç‚¹ä½äºæ ‘çš„æ ¹ä¸Šï¼Œæ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œç›´æ¥å°†å…¶æŸ“æˆé»‘è‰²å³å¯ã€‚è¿™ä¸ªåœ¨ä»£ç ä¸­æ— éœ€æ“ä½œï¼Œå› ä¸ºèŠ‚ç‚¹é»˜è®¤å°±æ˜¯é»‘è‰²çš„ã€‚
- è‹¥æ–°èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œè¿™ä¸ªæ—¶å€™æ ‘ä¾ç„¶æ»¡è¶³çº¢é»‘æ ‘çš„æ€§è´¨ï¼Œå¹¶ä¸éœ€è¦é¢å¤–çš„å¤„ç†ã€‚

ä»¥ä¸Šä¸¤ç§æƒ…å†µæ— éœ€é¢å¤–çš„å¤„ç†ï¼Œæˆ‘ä»¬å†æ¥è€ƒè™‘éœ€è¦å¤„ç†çš„æƒ…å†µã€‚

- æƒ…å†µ1ï¼šå¦‚æœæ–°èŠ‚ç‚¹Nçš„çˆ¶èŠ‚ç‚¹Pæ˜¯çº¢è‰²ï¼Œä¸”å…¶å”çˆ¶èŠ‚ç‚¹Uä¹Ÿä¸ºçº¢è‰²ï¼Œæˆ‘ä»¬å¯ä»¥å°†çˆ¶èŠ‚ç‚¹Pä¸å”çˆ¶èŠ‚ç‚¹UæŸ“æˆé»‘è‰²ï¼Œç¥–çˆ¶èŠ‚ç‚¹GæŸ“æˆçº¢è‰²ã€‚
- æƒ…å†µ2ï¼šå¦‚æœæ–°èŠ‚ç‚¹Nçš„çˆ¶èŠ‚ç‚¹Pæ˜¯çº¢è‰²ï¼Œä¸”å…¶å”çˆ¶èŠ‚ç‚¹Uä¸ºé»‘è‰²æˆ–è€…æ²¡æœ‰å”çˆ¶èŠ‚ç‚¹ï¼ŒPä¸ºå…¶çˆ¶èŠ‚ç‚¹Pçš„å³å­èŠ‚ç‚¹ï¼ŒPä¸ºä¸ºå…¶çˆ¶èŠ‚ç‚¹Gçš„å·¦å­èŠ‚ç‚¹ã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬é’ˆå¯¹ç¥–çˆ¶èŠ‚ç‚¹Gåšä¸€æ¬¡å³æ—‹ã€‚å¹¶å°†PæŸ“æˆé»‘è‰²ï¼ŒæŸ“æˆçº¢è‰²
- æƒ…å†µ3ï¼šå¦‚æœæ–°èŠ‚ç‚¹Nçš„çˆ¶èŠ‚ç‚¹Pæ˜¯çº¢è‰²ï¼Œä¸”å…¶å”çˆ¶èŠ‚ç‚¹Uä¸ºé»‘è‰²æˆ–è€…æ²¡æœ‰å”çˆ¶èŠ‚ç‚¹ï¼ŒPä¸ºå…¶çˆ¶èŠ‚ç‚¹Pçš„å³å­èŠ‚ç‚¹ï¼ŒPä¸ºä¸ºå…¶çˆ¶èŠ‚ç‚¹Gçš„å·¦å­èŠ‚ç‚¹ã€‚è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯¹åšä¸€æ¬¡å·¦æ—‹è°ƒæ¢ï¼Œè°ƒæ¢Pä¸Nçš„ä½ç½®ï¼Œè¿™æ ·æƒ…å†µ3å˜æˆäº†
æƒ…å†µ2ï¼Œå‰©ä¸‹çš„æŒ‰ç…§æƒ…å†µ2å¤„ç†å³å¯ã€‚

æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“çš„æºç å®ç°ã€‚

```java
public class TreeMap<K,V>
    extends AbstractMap<K,V>
    implements NavigableMap<K,V>, Cloneable, java.io.Serializable{
    
      //æŸ“è‰²
      private void fixAfterInsertion(TreeMapEntry<K,V> x) {
            x.color = RED;
    
            while (x != null && x != root && x.parent.color == RED) {
                
                //æ–°èŠ‚ç‚¹Nï¼ˆå³xï¼‰åœ¨å…¶ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸Šï¼Œå”çˆ¶èŠ‚ç‚¹åœ¨å·¦å­æ ‘ä¸Šã€‚
                if (parentOf(x) == leftOf(parentOf(parentOf(x)))) {
                    TreeMapEntry<K,V> y = rightOf(parentOf(parentOf(x)));
                    //æƒ…å†µ1ï¼šå¦‚æœæ–°èŠ‚ç‚¹Nçš„çˆ¶èŠ‚ç‚¹Pæ˜¯çº¢è‰²ï¼Œä¸”å…¶å”çˆ¶èŠ‚ç‚¹Uä¹Ÿä¸ºçº¢è‰²ï¼Œæˆ‘ä»¬å¯ä»¥å°†çˆ¶èŠ‚ç‚¹Pä¸å”çˆ¶èŠ‚ç‚¹UæŸ“æˆé»‘è‰²ï¼Œç¥–çˆ¶èŠ‚ç‚¹GæŸ“æˆçº¢è‰²ã€‚
                    if (colorOf(y) == RED) {
                        setColor(parentOf(x), BLACK);
                        setColor(y, BLACK);
                        setColor(parentOf(parentOf(x)), RED);
                        x = parentOf(parentOf(x));
                    } 
                    //æƒ…å†µ2ï¼šå¦‚æœæ–°èŠ‚ç‚¹Nçš„çˆ¶èŠ‚ç‚¹Pæ˜¯çº¢è‰²ï¼Œä¸”å…¶å”çˆ¶èŠ‚ç‚¹Uä¸ºé»‘è‰²æˆ–è€…æ²¡æœ‰å”çˆ¶èŠ‚ç‚¹ï¼ŒPä¸ºå…¶çˆ¶èŠ‚ç‚¹Pçš„å³å­èŠ‚ç‚¹ï¼ŒPä¸ºä¸ºå…¶çˆ¶èŠ‚ç‚¹Gçš„å·¦
                    //å­èŠ‚ç‚¹ã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬é’ˆå¯¹ç¥–çˆ¶èŠ‚ç‚¹Gåšä¸€æ¬¡å³æ—‹ã€‚å¹¶å°†PæŸ“æˆé»‘è‰²ï¼ŒæŸ“æˆçº¢è‰²
                    else {
                        //æƒ…å†µ3ï¼šxä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ï¼Œå…ˆå¯¹å…¶çˆ¶èŠ‚ç‚¹è¿›è¡Œå·¦æ—‹ï¼Œè°ƒæ¢ä¸¤è€…çš„ä½ç½®
                        if (x == rightOf(parentOf(x))) {
                            x = parentOf(x);
                            rotateLeft(x);
                        }
                        setColor(parentOf(x), BLACK);
                        setColor(parentOf(parentOf(x)), RED);
                        rotateRight(parentOf(parentOf(x)));
                    }
                } 
                //æƒ…å†µ1ï¼šæ–°èŠ‚ç‚¹Nï¼ˆå³xï¼‰åœ¨å…¶ç¥–çˆ¶èŠ‚ç‚¹çš„å³å­æ ‘ä¸Šï¼Œå”çˆ¶èŠ‚ç‚¹åœ¨å·¦å­æ ‘ä¸Šï¼Œè¿™ç§æƒ…å†µå’Œåœ¨å³å­èŠ‚ç‚¹çš„æƒ…å†µç›¸ä¼¼ï¼ŒçŸ¥è¯†æ—‹è½¬æ–¹å‘ç›¸åç½¢äº†ã€‚
                else {
                    TreeMapEntry<K,V> y = leftOf(parentOf(parentOf(x)));
                    //å¦‚æœæ–°èŠ‚ç‚¹Nçš„çˆ¶èŠ‚ç‚¹Pæ˜¯çº¢è‰²ï¼Œä¸”å…¶å”çˆ¶èŠ‚ç‚¹Uä¹Ÿä¸ºçº¢è‰²ï¼Œæˆ‘ä»¬å¯ä»¥å°†çˆ¶èŠ‚ç‚¹Pä¸å”çˆ¶èŠ‚ç‚¹UæŸ“æˆé»‘è‰²ï¼Œç¥–çˆ¶èŠ‚ç‚¹GæŸ“æˆçº¢è‰²ã€‚
                    if (colorOf(y) == RED) {
                        setColor(parentOf(x), BLACK);
                        setColor(y, BLACK);
                        setColor(parentOf(parentOf(x)), RED);
                        x = parentOf(parentOf(x));
                    } 
                   //æƒ…å†µ2ï¼šå¦‚æœæ–°èŠ‚ç‚¹Nçš„çˆ¶èŠ‚ç‚¹Pæ˜¯çº¢è‰²ï¼Œä¸”å…¶å”çˆ¶èŠ‚ç‚¹Uä¸ºé»‘è‰²æˆ–è€…æ²¡æœ‰å”çˆ¶èŠ‚ç‚¹ï¼ŒPä¸ºå…¶çˆ¶èŠ‚ç‚¹Pçš„å³å­èŠ‚ç‚¹ï¼ŒPä¸ºä¸ºå…¶çˆ¶èŠ‚ç‚¹Gçš„å·¦
                   //å­èŠ‚ç‚¹ã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬é’ˆå¯¹ç¥–çˆ¶èŠ‚ç‚¹Gåšä¸€æ¬¡å³æ—‹ã€‚å¹¶å°†PæŸ“æˆé»‘è‰²ï¼ŒæŸ“æˆçº¢è‰²
                    else {
                        //æƒ…å†µ3ï¼šxä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ï¼Œå…ˆå¯¹å…¶çˆ¶èŠ‚ç‚¹è¿›è¡Œå³æ—‹ï¼Œè°ƒæ¢ä¸¤è€…ä½ç½®ã€‚
                        if (x == leftOf(parentOf(x))) {
                            x = parentOf(x);
                            rotateRight(x);
                        }
                        setColor(parentOf(x), BLACK);
                        setColor(parentOf(parentOf(x)), RED);
                        rotateLeft(parentOf(parentOf(x)));
                    }
                }
            }
            root.color = BLACK;
        }
}
```
**èŠ‚ç‚¹æ—‹è½¬**

<img src="https://github.com/guoxiaoxing/data-structure-and-algorithm/raw/master/art/tree/node_rotate.png"/>

å·¦æ—‹

ä¹‹å‰åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€ç»„å…³äºå·¦æ—‹ã€å³æ—‹çš„åŠ¨æ€å›¾ï¼Œå¾ˆå½¢è±¡ï¼Œè¿™é‡Œä¹Ÿè´´å‡ºæ¥ã€‚

<img src="https://github.com/guoxiaoxing/data-structure-and-algorithm/raw/master/art/tree/rotate_left.gif"/>

1. æ‰¾åˆ°è¦æ—‹è½¬èŠ‚ç‚¹pçš„å³èŠ‚ç‚¹rï¼Œç„¶åå°†rçš„å·¦å­èŠ‚ç‚¹èµ‹å€¼ç»™pçš„å³å­èŠ‚ç‚¹ï¼Œå¦‚æœrçš„å·¦å­èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥å°†rèŠ‚ç‚¹è®¾ç½®ä¸ºPçš„çˆ¶èŠ‚ç‚¹ã€‚
2. å°†åŸæ¥pçš„çˆ¶èŠ‚ç‚¹è®¾ç½®æˆrçš„çˆ¶èŠ‚ç‚¹ï¼Œå¦‚æœåŸæ¥pçš„çˆ¶èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ¥rè®¾ç½®æˆæ ¹èŠ‚ç‚¹ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹ä¸ç©ºä¸”å…¶åšå­èŠ‚ç‚¹ä¸ºpï¼Œåˆ™å°†rè®¾ç½®ä¸ºæ–°çš„å·¦å­èŠ‚ç‚¹ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹ä¸ç©ºä¸”å…¶å³å­èŠ‚ç‚¹ä¸ºpï¼Œåˆ™å°†rè®¾ç½®ä¸ºæ–°çš„å³å­èŠ‚ç‚¹ï¼Œ
3. å†è®²rçš„å·¦å­èŠ‚ç‚¹è®¾ä¸ºpï¼Œpçš„çˆ¶èŠ‚ç‚¹è®¾ç½®ä¸ºrï¼Œå·¦æ—‹å®Œæˆã€‚

å³æ—‹

<img src="https://github.com/guoxiaoxing/data-structure-and-algorithm/raw/master/art/tree/rotate_right.gif"/>

1. æ‰¾åˆ°è¦æ—‹è½¬èŠ‚ç‚¹pçš„å·¦å­èŠ‚ç‚¹lï¼Œç„¶åå°†lçš„å³å­èŠ‚ç‚¹èµ‹å€¼ç»™pçš„å·¦å­èŠ‚ç‚¹ï¼Œå¦‚æœlçš„å³å­èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥å°†lèŠ‚ç‚¹è®¾ç½®ä¸ºPçš„çˆ¶èŠ‚ç‚¹ã€‚
2. å°†åŸæ¥pçš„çˆ¶èŠ‚ç‚¹è®¾ç½®æˆlçš„çˆ¶èŠ‚ç‚¹ï¼Œå¦‚æœåŸæ¥pçš„çˆ¶èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ¥lè®¾ç½®æˆæ ¹èŠ‚ç‚¹ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹ä¸ç©ºä¸”å…¶åšå­èŠ‚ç‚¹ä¸ºpï¼Œåˆ™å°†lè®¾ç½®ä¸ºæ–°çš„å·¦å­èŠ‚ç‚¹ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹ä¸ç©ºä¸”å…¶å³å­èŠ‚ç‚¹ä¸ºpï¼Œåˆ™å°†lè®¾ç½®ä¸ºæ–°çš„å³å­èŠ‚ç‚¹ï¼Œ
3. å†è®²lçš„å³å­èŠ‚ç‚¹è®¾ä¸ºpï¼Œpçš„çˆ¶èŠ‚ç‚¹è®¾ç½®ä¸ºlï¼Œå³æ—‹å®Œæˆã€‚

æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“çš„æºç å®ç°ã€‚

```java
public class TreeMap<K,V>
    extends AbstractMap<K,V>
    implements NavigableMap<K,V>, Cloneable, java.io.Serializable{
    
    //å·¦æ—‹
    private void rotateLeft(TreeMapEntry<K,V> p) {
        if (p != null) {
            //æ‰¾åˆ°è¦æ—‹è½¬èŠ‚ç‚¹pçš„å³èŠ‚ç‚¹r
            TreeMapEntry<K,V> r = p.right;
            //ç„¶åå°†rçš„å·¦å­èŠ‚ç‚¹èµ‹å€¼ç»™pçš„å³å­èŠ‚ç‚¹
            p.right = r.left;
            //å¦‚æœrçš„å·¦å­èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥å°†rèŠ‚ç‚¹è®¾ç½®ä¸ºPçš„çˆ¶èŠ‚ç‚¹
            if (r.left != null)
                r.left.parent = p;
            //å°†åŸæ¥pçš„çˆ¶èŠ‚ç‚¹è®¾ç½®æˆrçš„çˆ¶èŠ‚ç‚¹
            r.parent = p.parent;
            //å¦‚æœåŸæ¥pçš„çˆ¶èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ¥rè®¾ç½®æˆæ ¹èŠ‚ç‚¹
            if (p.parent == null)
                root = r;
            //å¦‚æœæ ¹èŠ‚ç‚¹ä¸ç©ºä¸”å…¶åšå­èŠ‚ç‚¹ä¸ºpï¼Œåˆ™å°†rè®¾ç½®ä¸ºæ–°çš„å·¦å­èŠ‚ç‚¹
            else if (p.parent.left == p)
                p.parent.left = r;
            //å¦‚æœæ ¹èŠ‚ç‚¹ä¸ç©ºä¸”å…¶å³å­èŠ‚ç‚¹ä¸ºpï¼Œåˆ™å°†rè®¾ç½®ä¸ºæ–°çš„å³å­èŠ‚ç‚¹ 
            else
                p.parent.right = r;
            //å†è®²rçš„å·¦å­èŠ‚ç‚¹è®¾ä¸ºpï¼Œpçš„çˆ¶èŠ‚ç‚¹è®¾ç½®ä¸ºrï¼Œå·¦æ—‹å®Œæˆ
            r.left = p;
            p.parent = r;
        }
    }

    //å³æ—‹
    private void rotateRight(TreeMapEntry<K,V> p) {
        if (p != null) {
            //æ‰¾åˆ°è¦æ—‹è½¬èŠ‚ç‚¹pçš„å·¦å­èŠ‚ç‚¹l
            TreeMapEntry<K,V> l = p.left;
            //ç„¶åå°†lçš„å³å­èŠ‚ç‚¹èµ‹å€¼ç»™pçš„å·¦å­èŠ‚ç‚¹
            p.left = l.right;
            //å¦‚æœlçš„å³å­èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥å°†lèŠ‚ç‚¹è®¾ç½®ä¸ºPçš„çˆ¶èŠ‚ç‚¹
            if (l.right != null) l.right.parent = p;
            //å°†åŸæ¥pçš„çˆ¶èŠ‚ç‚¹è®¾ç½®æˆlçš„çˆ¶èŠ‚ç‚¹
            l.parent = p.parent;
            //å¦‚æœåŸæ¥pçš„çˆ¶èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ¥lè®¾ç½®æˆæ ¹èŠ‚
            if (p.parent == null)
                root = l;
            //å¦‚æœæ ¹èŠ‚ç‚¹ä¸ç©ºä¸”å…¶å³å­èŠ‚ç‚¹ä¸ºpï¼Œåˆ™å°†lè®¾ç½®ä¸ºæ–°çš„å³å­èŠ‚ç‚¹
            else if (p.parent.right == p)
                p.parent.right = l;
            //å¦‚æœæ ¹èŠ‚ç‚¹ä¸ç©ºä¸”å…¶åšå­èŠ‚ç‚¹ä¸ºpï¼Œåˆ™å°†lè®¾ç½®ä¸ºæ–°çš„å·¦å­èŠ‚ç‚¹
            else p.parent.left = l;
            //å†è®²lçš„å³å­èŠ‚ç‚¹è®¾ä¸ºpï¼Œpçš„çˆ¶èŠ‚ç‚¹è®¾ç½®ä¸ºlï¼Œå³æ—‹å®Œæˆã€‚
            l.right = p;
            p.parent = l;
        }
    }
}
```
#### put

```java
public class TreeMap<K,V>
    extends AbstractMap<K,V>
    implements NavigableMap<K,V>, Cloneable, java.io.Serializable{
    
    public V put(K key, V value) {
            //æ‰¾åˆ°æ ¹èŠ‚ç‚¹
            TreeMapEntry<K,V> t = root;
            //å¦‚æœæ ¹èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™è®¾ç½®è¯¥å…ƒç´ ä¸ºæ ¹èŠ‚ç‚¹ã€‚
            if (t == null) {
                if (comparator != null) {
                    if (key == null) {
                        comparator.compare(key, key);
                    }
                } else {
                    if (key == null) {
                        throw new NullPointerException("key == null");
                    } else if (!(key instanceof Comparable)) {
                        throw new ClassCastException(
                                "Cannot cast" + key.getClass().getName() + " to Comparable.");
                    }
                }
    
                root = new TreeMapEntry<>(key, value, null);
                //é›†åˆå¤§å°ä¸º1
                size = 1;
                //ä¿®æ”¹æ¬¡æ•°è‡ªå¢
                modCount++;
                return null;
            }
            int cmp;
            TreeMapEntry<K,V> parent;
            //è·å–æ¯”è¾ƒå™¨
            Comparator<? super K> cpr = comparator;
            //å¦‚æœæ¯”è¾ƒå™¨ä¸ç©ºï¼Œåˆ™ç”¨æŒ‡å®šçš„æ¯”è¾ƒå™¨è¿›è¡Œæ¯”è¾ƒ
            if (cpr != null) {
                //å¾ªç¯é€’å½’ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾æ’å…¥çš„ä½ç½®ï¼Œå³æŸ¥æ‰¾çš„å®ƒçš„çˆ¶èŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾æ–¹å¼å’Œæˆ‘ä»¬ä¸Šé¢è®²çš„äºŒå‰æ’åºæ ‘çš„æŸ¥æ‰¾æ–¹å¼ç›¸åŒ
                do {
                    parent = t;
                    cmp = cpr.compare(key, t.key);
                    //æ’å…¥å€¼å°äºå½“å‰èŠ‚ç‚¹ï¼Œåˆ™ç»§ç»­åœ¨å·¦å­æ ‘ä¸ŠæŸ¥è¯¢
                    if (cmp < 0)
                        t = t.left;
                    //æ’å…¥å€¼å¤§äºå½“å‰èŠ‚ç‚¹ï¼Œåˆ™ç»§ç»­åœ¨å³å­æ ‘ä¸ŠæŸ¥è¯¢
                    else if (cmp > 0)
                        t = t.right;
                    //å¦‚æœç›¸ç­‰ï¼Œåˆ™æ›¿æ¢å½“å‰çš„å€¼
                    else
                        return t.setValue(value);
                } while (t != null);
            }
            //å¦‚æœæ¯”è¾ƒå™¨ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„æ¯”è¾ƒå™¨
            else {
                if (key == null)
                    throw new NullPointerException();
                @SuppressWarnings("unchecked")
                    Comparable<? super K> k = (Comparable<? super K>) key;
                do {
                    parent = t;
                    cmp = k.compareTo(t.key);
                    if (cmp < 0)
                        t = t.left;
                    else if (cmp > 0)
                        t = t.right;
                    else
                        return t.setValue(value);
                } while (t != null);
            }
            //æ ¹æ®æŸ¥æ‰¾åˆ°çš„çˆ¶èŠ‚ç‚¹ï¼Œæ„é€ èŠ‚ç‚¹ï¼Œå¹¶æ ¹æ®æ¯”ç»“æœå°†å…¶æ’å…¥åˆ°å¯¹åº”çš„ä½ç½®
            TreeMapEntry<K,V> e = new TreeMapEntry<>(key, value, parent);
            if (cmp < 0)
                parent.left = e;
            else
                parent.right = e;
            //ç»™æ’å…¥çš„èŠ‚ç‚¹æŸ“è‰²
            fixAfterInsertion(e);
            size++;
            modCount++;
            return null;
        }
}
```

æ’å…¥æ“ä½œé‡‡ç”¨äº†äºŒå‰æ’åºæ ‘çš„æŸ¥æ‰¾ç®—æ³•ï¼Œæ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š

1. å¦‚æœå½“å‰TreeMapæ²¡æœ‰æ ¹èŠ‚ç‚¹ï¼Œå°†å½“å‰èŠ‚ç‚¹ä½œä¸ºæ ¹èŠ‚ç‚¹æ’å…¥ï¼Œå¦åˆ™ï¼Œ
2. æ ¹æ®æä¾›çš„æ¯”è¾ƒå™¨ï¼ˆå¦‚æœæ²¡æœ‰æä¾›åˆ™ä½¿ç”¨é»˜è®¤çš„æ¯”è¾ƒå™¨ï¼‰è¿›è¡ŒæŸ¥æ‰¾æ¯”è¾ƒï¼ŒæŸ¥æ‰¾è¯¥èŠ‚ç‚¹çš„æ’å…¥ä½ç½®ï¼Œå³å®ƒçš„çˆ¶èŠ‚ç‚¹çš„ä½ç½®ã€‚
3. æŸ¥æ‰¾åˆ°çˆ¶èŠ‚ç‚¹åï¼Œæ ¹æ®æ¯”è¾ƒç»“æœæ’å…¥åˆ°å¯¹åº”ä½ç½®ï¼Œå¹¶è¿›è¡ŒæŸ“è‰²å¤„ç†ã€‚

#### remove

å‰é¢æˆ‘ä»¬è®²äº†æ’å…¥æ“ä½œï¼Œåˆ é™¤æ“ä½œè¦æ¯”æ’å…¥æ“ä½œå¤æ‚ä¸€ä¸‹ï¼Œæˆ‘ä»¬å…ˆæ¥æè¿°ä¸€ä¸‹åˆ é™¤æ“ä½œçš„å¤§æ¦‚æµç¨‹ï¼š

1. å°†çº¢é»‘æ ‘å½“æˆä¸€æ£µäºŒå‰æŸ¥æ‰¾æ ‘ï¼Œè¿›è¡ŒèŠ‚ç‚¹åˆ é™¤ã€‚
2. é€šè¿‡æ—‹è½¬å’Œç€è‰²ï¼Œä½¿å…¶é‡æ–°å˜æˆä¸€æ£µå¤åˆè§„åˆ™çš„çº¢é»‘æ ‘ã€‚

äºŒå‰æŸ¥æ‰¾æ ‘æ—¶æ€ä¹ˆåšåˆ é™¤çš„ã€‚å‰é¢æˆ‘ä»¬å·²ç»è¯´è¿‡ï¼Œåœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸Šåˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š

<img src="https://github.com/guoxiaoxing/data-structure-and-algorithm/raw/master/art/tree/red_black_tree_remove.png"/>

1. è‹¥åˆ é™¤çš„æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™ä¸ä¼šç ´åæ ‘çš„ç»“æ„ï¼Œåªéœ€è¦ä¿®æ”¹å…¶åŒäº²èŠ‚ç‚¹çš„æŒ‡é’ˆå³å¯ã€‚
2. è‹¥åˆ é™¤çš„èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­©å­èŠ‚ç‚¹ï¼Œåˆ™ç”¨å®ƒçš„å­©å­èŠ‚ç‚¹ä»£æ›¿å®ƒçš„ä½ç½®å³å¯ï¼Œå¦‚æ­¤ä¹Ÿä¸ä¼šç ´åçº¢é»‘æ ‘çš„ç»“æ„ã€‚
3. è‹¥åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­©å­èŠ‚ç‚¹ï¼Œè¿™ç§æƒ…å†µå¤æ‚ä¸€ä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ‰¾åˆ°è¦åˆ é™¤èŠ‚ç‚¹Xçš„å·¦å­æ ‘é‡Œçš„æœ€å¤§å…ƒç´ æˆ–è€…å³å­æ ‘é‡Œçš„æœ€å°å…ƒç´ ï¼Œç„¶åç”¨Mæ›¿æ¢æ‰Xï¼Œå†åˆ é™¤èŠ‚ç‚¹ï¼Œå› ä¸ºæ­¤æ—¶Mæœ€å¤šåªä¼šæœ‰ä¸€ä¸ª
èŠ‚ç‚¹ï¼ˆå¦‚æœå·¦å­æ ‘æœ€å¤§å…ƒç´ åˆ™æ²¡æœ‰å³å­èŠ‚ç‚¹ï¼Œè‹¥æ˜¯å³å­æ ‘æœ€å°å…ƒç´ åˆ™æ²¡æœ‰å·¦å­èŠ‚ç‚¹ï¼‰ï¼Œè‹¥Mæ²¡æœ‰å­©å­èŠ‚ç‚¹ï¼Œç›´æ¥è¿›å…¥æƒ…å†µ1å¤„ç†ï¼Œè‹¥Måªæœ‰ä¸€ä¸ªå­©å­ï¼Œåˆ™ç›´æ¥è¿›å…¥æƒ…å†µ2å¤„ç†ã€‚

æ³¨ï¼šè¿™é‡Œçš„æ›¿æ¢æŒ‡çš„æ˜¯å€¼æ‹·è´ï¼Œå€¼æ‹·è´å¹¶ä¸ä¼šç ´åçº¢é»‘æ ‘çš„æ€§è´¨ã€‚

è¿™æ ·ä¸‰ç§æƒ…å†µéƒ½å¯ä»¥å½“åšç¬¬ä¸€ç§æˆ–è€…ç¬¬äºŒç§æƒ…å†µå¤„ç†ã€‚

åœ¨åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼š

- å¦‚æœåˆ é™¤çš„é¢æ˜¯çº¢è‰²èŠ‚ç‚¹ï¼Œä¸ä¼šè¿åçº¢é»‘æ ‘çš„è§„åˆ™ã€‚
- å¦‚æœåˆ é™¤çš„æ˜¯é»‘è‰²èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªè·¯å¾„ä¸Šå°±å°‘äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œåˆ™è¿åäº†çº¢é»‘æ ‘è§„åˆ™ã€‚

è¿™æ ·æˆ‘ä»¬å¯ä»¥å¾—çŸ¥åªæœ‰åœ¨æ’å…¥çš„èŠ‚ç‚¹æ˜¯é»‘è‰²çš„æ—¶å€™æ‰éœ€è¦æˆ‘ä»¬è¿›è¡Œå¤„ç†ï¼Œå…·ä½“è¯´æ¥ï¼š

- æƒ…å†µ1ï¼šè‹¥åˆ é™¤èŠ‚ç‚¹Nçš„å…„å¼ŸèŠ‚ç‚¹Bæ˜¯çº¢è‰²ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå…ˆå¯¹çˆ¶èŠ‚ç‚¹Pè¿›è¡Œå·¦æ—‹æ“ä½œï¼Œç»“åˆå¯¹æ¢Pä¸Bçš„é¢œè‰²ã€‚æ­¤æ—¶å·¦å­æ ‘ä»ç„¶å°‘äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œæ­¤æ—¶è¿›å…¥æƒ…å†µ3.
- æƒ…å†µ2ï¼šè‹¥åˆ é™¤èŠ‚ç‚¹Nçš„çˆ¶äº²èŠ‚ç‚¹Pï¼Œå…„å¼ŸèŠ‚ç‚¹Bä»¥åŠBçš„å„¿å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²ï¼Œåˆ™å°†BæŸ“æˆçº¢è‰²ï¼Œè¿™æ ·Påˆ°å¶å­èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«äº†ç›¸åŒçš„é»‘è‰²èŠ‚ç‚¹ï¼Œä½†æ˜¯Pçš„çˆ¶èŠ‚ç‚¹Gåˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„å´å°‘äº†
ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦é‡æ–°æŒ‰ç…§è¿™å¥—è§„åˆ™å¯¹PèŠ‚ç‚¹å†è¿›è¡Œä¸€æ¬¡å¹³è¡¡å¤„ç†ã€‚
- æƒ…å†µ3ï¼šè‹¥åˆ é™¤èŠ‚ç‚¹Nçš„çˆ¶äº²èŠ‚ç‚¹Pæ˜¯çº¢è‰²ï¼Œå…„å¼ŸèŠ‚ç‚¹Bæ˜¯é»‘è‰²ï¼Œåˆ™äº¤æ¢Pä¸Bé¢œè‰²ï¼Œè¿™æ ·åœ¨Bæ‰€åœ¨è·¯å¾„ä¸Šå¢åŠ äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œå¼¥è¡¥äº†å·²ç»åˆ é™¤çš„ï¼Œæ ‘é‡æ–°è¾¾åˆ°å¹³è¡¡ã€‚
- æƒ…å†µ4ï¼š è‹¥åˆ é™¤èŠ‚ç‚¹Nçš„å…„å¼ŸèŠ‚ç‚¹Bæ˜¯é»‘æ¶©ï¼ŒBçš„å·¦å­©å­èŠ‚ç‚¹BLæ˜¯çº¢è‰²ï¼ŒBçš„å³å­©å­èŠ‚ç‚¹BRæ˜¯é»‘è‰²ï¼ŒPä¸ºä»»æ„é¢œè‰²ã€‚åˆ™å‡ç¼“Bä¸BLçš„é¢œè‰²ï¼Œå³æ—‹èŠ‚ç‚¹Bã€‚æ­¤æ—¶Næ‰€åœ¨è·¯å¾„å¹¶æ²¡æœ‰å¢åŠ é»‘è‰²èŠ‚ç‚¹ï¼Œæ²¡æœ‰è¾¾åˆ°å¹³è¡¡ï¼Œè¿›å…¥æƒ…å†µ5.
- æƒ…å†µ5ï¼šè‹¥åˆ é™¤èŠ‚ç‚¹Nçš„å…„å¼ŸèŠ‚ç‚¹Bæ˜¯é»‘è‰²ï¼ŒBçš„å³å­©å­èŠ‚ç‚¹BRæ˜¯çº¢è‰²ï¼ŒBçš„å·¦å­©å­èŠ‚ç‚¹BLä¸ºä»»æ„é¢œè‰²ï¼ŒPä¸ºä»»æ„é¢œè‰²ã€‚åˆ™BRæŸ“æˆé»‘è‰²ï¼ŒPæŸ“æˆé»‘è‰²ï¼ŒBæŸ“æˆåŸæ¥Pçš„é¢œè‰²ï¼›å·¦æ—‹èŠ‚ç‚¹ï¼Œè¿™æ ·
Nè·¯å¾„ä¸Šå¢åŠ äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼ŒBè·¯å¾„ä¸Šå°‘äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹Bï¼Œåˆå¢åŠ äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹BRï¼Œåˆšå¥½è¾¾åˆ°å¹³è¡¡ã€‚

ä»¥ä¸Šçš„æµç¨‹çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œæœ¬è´¨ä¸Šæ¥è¯´å°±æ˜¯æˆ‘ä»¬åˆ é™¤äº†ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œç ´åäº†å½“å‰è·¯å¾„é»‘è‰²èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œè§£å†³çš„æ–¹æ³•è¦ä¹ˆä¸ºè¿™æ¡è·¯å¾„å†æ·»åŠ ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œè¦ä¹ˆå°†å…¶ä»–è·¯å¾„çš„é»‘è‰²èŠ‚ç‚¹éƒ½å»æ‰ä¸€ä¸ªã€‚

```java
public class TreeMap<K,V>
    extends AbstractMap<K,V>
    implements NavigableMap<K,V>, Cloneable, java.io.Serializable{
    
    public V remove(Object key) {
        TreeMapEntry<K,V> p = getEntry(key);
        if (p == null)
            return null;

        V oldValue = p.value;
        deleteEntry(p);
        return oldValue;
    }
    
     private void deleteEntry(TreeMapEntry<K,V> p) {
            //æ“ä½œè®°å½•è‡ªå¢
            modCount++;
            //é›†åˆå¤§å°è‡ªå‡
            size--;
    
            ///å¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹pçš„å·¦å³å­èŠ‚ç‚¹éƒ½ä¸ä¸ºç©ºï¼Œåˆ™æŸ¥æ‰¾å…¶æ›¿ä»£èŠ‚ç‚¹å¹¶è¿›è¡ŒèŠ‚ç‚¹æ›¿æ¢
            if (p.left != null && p.right != null) {
                //æŸ¥æ‰¾å…¶æ›¿ä»£èŠ‚ç‚¹ï¼Œæ›¿ä»£èŠ‚ç‚¹ä¸ºå·¦å­æ ‘çš„æœ€å¤§å…ƒç´ æˆ–è€…å³å­æ ‘çš„æœ€å°å…ƒç´ 
                TreeMapEntry<K,V> s = successor(p);
                p.key = s.key;
                p.value = s.value;
                p = s;
            } // p has 2 children
    
            //æŸ¥æ‰¾æ›¿ä»£èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹ï¼ŒreplacementæŒ‡çš„æ˜¯æˆ‘ä»¬å›¾ä¸­è¯´æ¥çš„NèŠ‚ç‚¹ï¼ŒpæŒ‡çš„æ˜¯å›¾ä¸­çš„
            TreeMapEntry<K,V> replacement = (p.left != null ? p.left : p.right);
            
            //åˆ é™¤pï¼Œå¹¶é‡æ–°å»ºç«‹replacementèŠ‚ç‚¹çš„è¿æ¥
            if (replacement != null) {
                replacement.parent = p.parent;
                if (p.parent == null)
                    root = replacement;
                else if (p == p.parent.left)
                    p.parent.left  = replacement;
                else
                    p.parent.right = replacement;
    
                // Null out links so they are OK to use by fixAfterDeletion.
                p.left = p.right = p.parent = null;
    
                //å¦‚æœåˆ é™¤çš„é»‘è‰²èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦é‡æ–°å¹³è¡¡æ ‘
                if (p.color == BLACK)
                    fixAfterDeletion(replacement);
            } else if (p.parent == null) { // return if we are the only node.
                root = null;
            } else { //  No children. Use self as phantom replacement and unlink.
                if (p.color == BLACK)
                    fixAfterDeletion(p);
    
                if (p.parent != null) {
                    if (p == p.parent.left)
                        p.parent.left = null;
                    else if (p == p.parent.right)
                        p.parent.right = null;
                    p.parent = null;
                }
            }
        }

    //æŸ¥æ‰¾å…¶æ›¿ä»£èŠ‚ç‚¹ï¼Œæ›¿ä»£èŠ‚ç‚¹ä¸ºå·¦å­æ ‘çš„æœ€å¤§å…ƒç´ æˆ–è€…å³å­æ ‘çš„æœ€å°å…ƒç´ 
    static <K,V> TreeMapEntry<K,V> successor(TreeMapEntry<K,V> t) {
        if (t == null)
            return null;
        //æŸ¥æ‰¾å³å­æ ‘çš„æœ€å°å…ƒç´ ï¼Œå³æœ€å·¦å­©å­
        else if (t.right != null) {
            TreeMapEntry<K,V> p = t.right;
            while (p.left != null)
                p = p.left;
            return p;
        } 
        //æŸ¥æ‰¾å·¦å­æ ‘çš„æœ€å¤§å…ƒç´ ï¼Œå³æœ€å³å­©å­
        else {
            TreeMapEntry<K,V> p = t.parent;
            TreeMapEntry<K,V> ch = t;
            while (p != null && ch == p.right) {
                ch = p;
                p = p.parent;
            }
            return p;
        }
    }

    static <K,V> TreeMapEntry<K,V> predecessor(TreeMapEntry<K,V> t) {
        if (t == null)
            return null;
        else if (t.left != null) {
            TreeMapEntry<K,V> p = t.left;
            while (p.right != null)
                p = p.right;
            return p;
        } else {
            TreeMapEntry<K,V> p = t.parent;
            TreeMapEntry<K,V> ch = t;
            while (p != null && ch == p.left) {
                ch = p;
                p = p.parent;s
            }
            return p;
        }
    }
}
```

æˆ‘ä»¬å†æ¥çœ‹çœ‹deleteEntry()æ–¹æ³•çš„å®ç°æµç¨‹ï¼š

1. å¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹pçš„å·¦å³å­èŠ‚ç‚¹éƒ½ä¸ä¸ºç©ºï¼Œåˆ™æŸ¥æ‰¾å…¶æ›¿ä»£èŠ‚ç‚¹å¹¶è¿›è¡ŒèŠ‚ç‚¹æ›¿æ¢ã€‚
2. æŸ¥æ‰¾æ›¿ä»£èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹ï¼ŒreplacementæŒ‡çš„æ˜¯æˆ‘ä»¬å›¾ä¸­è¯´æ¥çš„NèŠ‚ç‚¹ï¼ŒpæŒ‡çš„æ˜¯å›¾ä¸­çš„Mï¼Œå¦‚æœpæ˜¯é»‘è‰²èŠ‚ç‚¹ï¼Œåˆ™åˆ é™¤påéœ€è¦é‡æ–°è¿›è¡Œ
æ ‘çš„å¹³è¡¡å¤„ç†ã€‚

#### get

```java
public class TreeMap<K,V>
    extends AbstractMap<K,V>
    implements NavigableMap<K,V>, Cloneable, java.io.Serializable{
 
    public V get(Object key) {
        TreeMapEntry<K,V> p = getEntry(key);
        return (p==null ? null : p.value);
    }
    
    final TreeMapEntry<K,V> getEntry(Object key) {
        // Offload comparator-based version for sake of performance
        if (comparator != null)
            return getEntryUsingComparator(key);
        if (key == null)
            throw new NullPointerException();
        @SuppressWarnings("unchecked")
            Comparable<? super K> k = (Comparable<? super K>) key;
        TreeMapEntry<K,V> p = root;
        //ä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ï¼Œæ ¹æ®æ¯”è¾ƒç»“æœå†³å®šä»å·¦å­æ ‘å¼€å§‹æŸ¥æ‰¾è¿˜æ˜¯ä»å³å­æ ‘å¼€å§‹æŸ¥æ‰¾
        while (p != null) {
            int cmp = k.compareTo(p.key);
            if (cmp < 0)
                p = p.left;
            else if (cmp > 0)
                p = p.right;
            else
                return p;
        }
        return null;
    }
}
```
TreeMapçš„æŸ¥æ‰¾æµç¨‹å’ŒäºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾æµç¨‹æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œæ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ï¼Œæ ¹æ®æ¯”è¾ƒç»“æœå†³å®šæ˜¯ä¸‹ä¸€æ­¥æ˜¯ä»å·¦å­æ ‘å¼€å§‹æŸ¥æ‰¾ï¼Œè¿˜æ˜¯ä»å³å­æ ‘å¼€å§‹æŸ¥æ‰¾ã€‚

## äºŒ TreeSetå®ç°åŸç†

>TreeSetå®é™…ä¸Šæ˜¯åŸºäºTreeMapçš„NavigableSetçš„å®ç°ï¼Œå®ƒç”¨TreeMapçš„keyæ¥å­˜å‚¨å€¼

TreeSetçš„ç±»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

<img src="https://github.com/guoxiaoxing/data-structure-and-algorithm/raw/master/art/tree/TreeSet_class.png"/>

## 2.1 æˆå‘˜å˜é‡

```java
/**
 * The backing map.
 */
private transient NavigableMap<E,Object> m;

// Dummy value to associate with an Object in the backing Map
private static final Object PRESENT = new Object();
```

å¯ä»¥çœ‹åˆ°TreeSetä½¿ç”¨NavigableMapæ¥å­˜å‚¨æ•°æ®ï¼ŒNavigableMapæ˜¯ä»€ä¹ˆå‘¢ï¼ŸğŸ¤”

- NavigableMapæ˜¯ä¸€ä¸ªæ¥å£ï¼Œç»§æ‰¿äºSortedMapï¼ŒTreeMapå®ç°äº†NavigableMapæ¥å£ï¼Œå®ƒå¯ä»¥æä¾›ç»™æŒ‡å®šæœç´¢ç›®æ ‡è¿”å›æœ€ä½³åŒ¹é…é¡¹çš„æ–¹æ³•ï¼Œå…·ä½“è¯´æ¥ï¼šå®ƒçš„æ–¹æ³•lowerEntry()ã€floorEntry()ã€ceilingEntry()å’ŒhigherEntry()åˆ†åˆ«è¿”å›ä¸å°äºã€å°äºç­‰äºã€å¤§äºç­‰äºã€å¤§äº
ç»™å®šé”®çš„é”®å…³è”çš„Map.Entryå¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨è¿™æ ·çš„é”®ï¼Œåˆ™è¿”å› nullã€‚ç±»ä¼¼åœ°ï¼Œæ–¹æ³•lowerKey()ã€floorKey()ã€ceilingKey()å’ŒhigherKey()åªè¿”å›å…³è”çš„é”®ï¼ˆè¿™äº›æ–¹æ³•æ˜¯ä¸ºæŸ¥æ‰¾æ¡ç›®è€Œä¸æ˜¯éå†æ¡ç›®è€Œè®¾è®¡çš„ï¼‰ã€‚

è¿˜æœ‰ä¸ªä¸ä¹‹ç±»ä¼¼çš„NavigableSetï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

- NavigableSetä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œç»§æ‰¿äºSortedSetï¼Œå®ƒå¯ä»¥æä¾›ç»™æŒ‡å®šæœç´¢ç›®æ ‡è¿”å›æœ€ä½³åŒ¹é…é¡¹çš„æ–¹æ³•ï¼Œå…·ä½“è¯´æ¥ï¼šå®ƒçš„æ–¹æ³•lower()ã€floor()ã€ceiling()å’Œhigher()åˆ†åˆ«è¿”å›å°äºã€å°äºç­‰äºã€å¤§äºç­‰äºã€å¤§äºç»™å®šå…ƒç´ çš„å…ƒç´ ï¼Œå¦‚æœä¸
å­˜åœ¨è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è¿”å›nullã€‚

### 2.2 æ„é€ æ–¹æ³•

æ„é€ æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public class TreeSet<E> extends AbstractSet<E>
    implements NavigableSet<E>, Cloneable, java.io.Serializable
{
    
    TreeSet(NavigableMap<E,Object> m) {
        this.m = m;
    }


    public TreeSet() {
        this(new TreeMap<E,Object>());
    }

    public TreeSet(Comparator<? super E> comparator) {
        this(new TreeMap<>(comparator));
    }


    public TreeSet(Collection<? extends E> c) {
        this();
        addAll(c);
    }

    public TreeSet(SortedSet<E> s) {
        this(s.comparator());
        addAll(s);
    }
}
```
å¯ä»¥æŒ‡å®šåˆå§‹å…ƒç´ é›†åˆï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ¯”è¾ƒå™¨ã€‚

### 2.3 æ“ä½œæ–¹æ³•

TreeSeté‡Œçš„æ–¹æ³•éƒ½æ˜¯è°ƒç”¨TreeMapé‡Œçš„æ–¹æ³•æ¥å®Œæˆçš„ã€‚

```java
public class TreeSet<E> extends AbstractSet<E>
    implements NavigableSet<E>, Cloneable, java.io.Serializable{
     public boolean add(E e) {
            return m.put(e, PRESENT)==null;
        }
    
    public boolean remove(Object o) {
        return m.remove(o)==PRESENT;
    }
}
```